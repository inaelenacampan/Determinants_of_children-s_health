<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>script.analyse_data API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../script.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;script</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#bar_plot">bar_plot</a>
            </li>
            <li>
                    <a class="function" href="#mca_analysis">mca_analysis</a>
            </li>
            <li>
                    <a class="function" href="#mca_plot_individuals">mca_plot_individuals</a>
            </li>
            <li>
                    <a class="function" href="#mca_plot_individuals_group">mca_plot_individuals_group</a>
            </li>
            <li>
                    <a class="function" href="#mca_plot_categories">mca_plot_categories</a>
            </li>
            <li>
                    <a class="function" href="#heatmap_generator">heatmap_generator</a>
            </li>
            <li>
                    <a class="function" href="#map_united_states">map_united_states</a>
            </li>
            <li>
                    <a class="function" href="#interactive_map">interactive_map</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../script.html">script</a><wbr>.analyse_data    </h1>

                
                        <input id="mod-analyse_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-analyse_data-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">prince</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">folium</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>  <span class="c1"># pour la gestion des données géographiques (fichiers .shp)</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">branca</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">clear_output</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="k">def</span><span class="w"> </span><span class="nf">bar_plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">guide</span><span class="p">):</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    Réaliser un bar plot.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    Args :</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">        year (str) : années d&#39;intéret</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">        dfs (dict) : dictionnaire des bases de données</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">        variable (str) : Le critère de regroupement.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        guide (pd object) : Le guide des variables NSCH.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Returns : un bar plot</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">year</span><span class="p">]</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="c1"># récuperer la signification du codage de la réponse</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="n">responde_str</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Response Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="n">code_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">responde_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;||&#39;</span><span class="p">))</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="n">question_text</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="c1"># eviter l&#39;affichage d&#39;un warning lié au ticks</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="n">ticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="n">old_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="c1"># on utilise le dictionnaire pour un affichage lisible</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="n">new_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">code_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">old_labels</span><span class="p">]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">new_labels</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="c1"># pivoter les labels</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Réponse&quot;</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Effectif&quot;</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition de la variable d&#39;intérêt </span><span class="se">\n</span><span class="si">{</span><span class="n">question_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_analysis</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">drop_columns</span><span class="p">):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    Réaliser une ACM.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    Args:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        year (str): L&#39;année du formulaire.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        dfs (dict): Le dictionnaire des bases des formulaires NSCH.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        drop_columns (list) : La liste des colonnes à filtrer.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    Returns:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        mca : Objet mca.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">year</span><span class="p">]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">df_mca</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">drop_columns</span><span class="p">])</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">df_mca</span> <span class="o">=</span> <span class="n">df_mca</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_mca</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;imputed&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">mca</span> <span class="o">=</span> <span class="n">prince</span><span class="o">.</span><span class="n">MCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="k">return</span> <span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_plot_individuals</span><span class="p">(</span><span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span><span class="p">):</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    Visualisation des individus de la base de données dans un plan 2D.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    Args:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        mca : L&#39;objet mca.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    Returns:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        génération d&#39;un plot (pas de return explicite)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="n">row_coords</span> <span class="o">=</span> <span class="n">mca</span><span class="o">.</span><span class="n">row_coordinates</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="c1"># Scatter plot</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="n">row_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="n">row_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>        <span class="c1"># taille des points</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>   <span class="c1"># transparence pour zones denses</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Individus&#39;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="c1"># Labels et titre</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Analyse en Composantes Multiples, Individus&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="c1"># Pour une grille</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_plot_individuals_group</span><span class="p">(</span><span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">guide</span><span class="p">):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    Visualisation des individus selon un critère de regroument.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">    Args:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        mca : L&#39;objet mca.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        variable (str) : Le critère de regroupement.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        guide (pd object) : Le guide des variables NSCH.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">    Returns:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        génération d&#39;un plot (pas de return explicite)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="n">row_coords</span> <span class="o">=</span> <span class="n">mca</span><span class="o">.</span><span class="n">row_coordinates</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="n">groups</span> <span class="o">=</span> <span class="n">df_mca</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="c1"># Les variables sont catégorielles et la légende se présente sous forme d&#39;un str</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="c1"># format : ciffre1 = ... || chiffre2 = ...</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="n">responde_str</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Response Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="n">code_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">responde_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;||&#39;</span><span class="p">))</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_mca</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">row_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">row_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="c1"># Scatter plot par groupe</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">code_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="c1"># code adapté depuis internet pour manipuler les ellipses</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="c1"># Ellipse pour montrer un regroupement des individus</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="c1"># plus d&#39;un individu</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="c1"># calcule les valeurs propres (vals) et vecteurs propres (vecs) d’une matrice symétrique</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># facteur 2 pour agrandir ellipse</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">*</span><span class="n">vecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="n">ell</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                          <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                          <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                          <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="c1"># GCA = Get Current Axes</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ell</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="c1"># Récupération du texte de la question pour le titre</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="n">question_text</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ACM des individus par groupe: </span><span class="se">\n</span><span class="si">{</span><span class="n">question_text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_plot_categories</span><span class="p">(</span><span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span><span class="p">,</span> <span class="n">seuil</span><span class="p">):</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">    Visualisation des modalités (variables catégorielles) de la base de données dans un plan 2D.</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    Args:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        mca : L&#39;objet mca.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        seuil (int) : Pour mieux visualiser le graphique, combien de composantes &quot;principales&quot;.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    Returns:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        génération d&#39;une figure avec 2 plot (pas de return explicite)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="c1"># Pour les modalités, le graphique est très dense</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>    <span class="c1"># La longueur de la flèche indique l’importance de cette modalité dans l’espace MCA</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="c1"># plus la flèche est longue, plus cette modalité contribue à la variance</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="c1"># des premières dimensions.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="n">column_coords</span> <span class="o">=</span> <span class="n">mca</span><span class="o">.</span><span class="n">column_coordinates</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">column_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">column_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="n">top</span> <span class="o">=</span> <span class="n">distances</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">seuil</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="n">principales</span> <span class="o">=</span> <span class="n">column_coords</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">top</span><span class="p">]</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="n">secondaires</span> <span class="o">=</span> <span class="n">column_coords</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  <span class="c1"># 1 ligne, 2 plots</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>    <span class="c1"># Plot n°1</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">principales</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">principales</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">principales</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Modalités principales&#39;</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>    <span class="c1"># Plot n°2</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">secondaires</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">secondaires</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">secondaires</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Modalités restantes&#39;</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="k">def</span><span class="w"> </span><span class="nf">heatmap_generator</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">    Visualisation de la matrice des corrélations de façon hierarchique.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">    Args:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        df : La base de données.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    Returns:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        génération d&#39;un plot (pas de return explicite)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>  <span class="c1"># style propre</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="c1"># Clustermap =&gt; Un clustering hiérarchique</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="c1"># Il regroupe automatiquement les variables qui se ressemblent le plus.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>    <span class="c1"># Un réarrangement automatique des lignes et colonnes</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="c1"># Pour mettre ensemble les variables ayant un comportement similaire.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">matrix</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="c1"># masquer la valeur de la corrélation</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="n">dendrogram_ratio</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>  <span class="c1"># taille des dendrogrammes - l&#39;arrangement de groupes générés</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">cbar_pos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">),</span>  <span class="c1"># position de la barre de couleur</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">robust</span><span class="o">=</span><span class="kc">True</span>          <span class="c1"># évite que des valeurs extrêmes dominent l&#39;affichage</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Clustermap de la matrice de corrélation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="k">def</span><span class="w"> </span><span class="nf">map_united_states</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">    Crée une carte choroplèthe interactive des États-Unis représentant</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">    un indicateur global de santé des enfants pour une année donnée.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">    La carte est générée à l’aide de Folium à partir de données géographiques</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">    (GeoDataFrame) et d’un DataFrame contenant les indicateurs de santé.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">    Chaque État est coloré selon la valeur de l’indicateur, allant du rouge</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    (faible niveau de santé) au vert foncé (meilleur niveau de santé).</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">    Args:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        df_indicator : pandas.DataFrame</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">            DataFrame contenant l&#39;indicateur de santé par État.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">            L&#39;index doit correspondre au code FIPS des États (FIPSST).</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            Il doit contenir une colonne nommée :</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">            &quot;indicator_global_health_&lt;year&gt;&quot;.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        df_geo : geopandas.GeoDataFrame</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">            GeoDataFrame contenant les polygones des États américains.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">            Doit inclure les colonnes :</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">            - &quot;GeoFIPS&quot; : code FIPS sous forme de chaîne</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">            - &quot;GeoName&quot; : nom de l&#39;État</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">            - &quot;geometry&quot; : géométrie des États</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        year : str</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">            Année de l&#39;indicateur de santé à afficher sur la carte.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    Returns:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        folium.Map</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">            Objet Folium représentant la carte interactive des États-Unis,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">            avec une légende et des infobulles affichant le nom de l&#39;État</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">            et la valeur de l&#39;indicateur de santé.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    Références</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">    ----------</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    Tutoriel Folium utilisé :</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    https://python-visualization.github.io/folium/latest/user_guide/geojson/geojson_popup_and_tooltip.html</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="n">new_df</span> <span class="o">=</span> <span class="n">df_geo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="n">new_df</span><span class="p">[</span><span class="s2">&quot;FIPSST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_df</span><span class="p">[</span><span class="s2">&quot;GeoFIPS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">new_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="n">df_indicator</span> <span class="o">=</span> <span class="n">df_indicator</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;FIPSST&#39;</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="c1"># Merge pour ajouter l&#39;indicateur dans gdf</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;FIPSST&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>    <span class="c1"># Centrer la carte sur les USA</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">([</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">min_zoom</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_zoom</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>    <span class="c1"># Créer une échelle de couleur propre : rouge ---&gt; vert</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="n">colormap</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">LinearColormap</span><span class="p">(</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="n">vmin</span><span class="o">=</span><span class="n">gdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">vmax</span><span class="o">=</span><span class="n">gdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;darkgreen&quot;</span><span class="p">],</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Indice global de santé (0-1) pour l&#39;année </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>    <span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="c1"># ajout des polygones et des messages</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="n">folium</span><span class="o">.</span><span class="n">GeoJson</span><span class="p">(</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="n">gdf</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">style_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">feature</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="s1">&#39;fillColor&#39;</span><span class="p">:</span> <span class="n">colormap</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]),</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="s1">&#39;fillOpacity&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="p">},</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GeoName&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;État:&quot;</span><span class="p">,</span> <span class="s2">&quot;Indice santé :&quot;</span><span class="p">],</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="n">localize</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="c1"># Ajouter la légende du colormap</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>    <span class="n">colormap</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>    <span class="k">return</span> <span class="n">m</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="k">def</span><span class="w"> </span><span class="nf">interactive_map</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    Affiche une carte interactive des États-Unis permettant de visualiser</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">    l&#39;évolution d&#39;un indicateur global de santé des enfants selon l&#39;année.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">    Cette fonction utilise des widgets ipywidgets pour créer un menu</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    déroulant de sélection de &#39;’année. Lorsque l&#39;année change, la carte</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">    choroplèthe correspondante est automatiquement mise à jour.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">    Args:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">        df_indicator : pandas.DataFrame</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">            DataFrame contenant les indicateurs de santé par État et par année.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">            L&#39;index doit correspondre au code FIPS des États (FIPSST).</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">            Les colonnes doivent être nommées sous la forme :</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">            &quot;indicator_global_health_&lt;year&gt;&quot;.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        df_geo : geopandas.GeoDataFrame</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">            GeoDataFrame contenant les informations géographiques des États</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">            américains (polygones, noms des États et codes FIPS).</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    Returns:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        None</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">            La fonction ne retourne rien. Elle affiche directement un widget</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">            interactif et une carte Folium dans le notebook Jupyter.</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2021&quot;</span><span class="p">,</span> <span class="s2">&quot;2022&quot;</span><span class="p">,</span> <span class="s2">&quot;2023&quot;</span><span class="p">,</span> <span class="s2">&quot;2024&quot;</span><span class="p">]</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>    <span class="n">year_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">options</span><span class="o">=</span><span class="n">years</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2024&quot;</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Année:&#39;</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_map</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>            <span class="n">display</span><span class="p">(</span><span class="n">map_united_states</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]))</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="n">year_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_map</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="n">display</span><span class="p">(</span><span class="n">year_selector</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="n">display</span><span class="p">(</span><span class="n">map_united_states</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year_selector</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span></pre></div>


            </section>
                <section id="bar_plot">
                            <input id="bar_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bar_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">year</span>, </span><span class="param"><span class="n">dfs</span>, </span><span class="param"><span class="n">variable</span>, </span><span class="param"><span class="n">guide</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bar_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bar_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bar_plot-15"><a href="#bar_plot-15"><span class="linenos">15</span></a><span class="k">def</span><span class="w"> </span><span class="nf">bar_plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">guide</span><span class="p">):</span>
</span><span id="bar_plot-16"><a href="#bar_plot-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="bar_plot-17"><a href="#bar_plot-17"><span class="linenos">17</span></a><span class="sd">    Réaliser un bar plot.</span>
</span><span id="bar_plot-18"><a href="#bar_plot-18"><span class="linenos">18</span></a>
</span><span id="bar_plot-19"><a href="#bar_plot-19"><span class="linenos">19</span></a><span class="sd">    Args :</span>
</span><span id="bar_plot-20"><a href="#bar_plot-20"><span class="linenos">20</span></a><span class="sd">        year (str) : années d&#39;intéret</span>
</span><span id="bar_plot-21"><a href="#bar_plot-21"><span class="linenos">21</span></a><span class="sd">        dfs (dict) : dictionnaire des bases de données</span>
</span><span id="bar_plot-22"><a href="#bar_plot-22"><span class="linenos">22</span></a><span class="sd">        variable (str) : Le critère de regroupement.</span>
</span><span id="bar_plot-23"><a href="#bar_plot-23"><span class="linenos">23</span></a><span class="sd">        guide (pd object) : Le guide des variables NSCH.</span>
</span><span id="bar_plot-24"><a href="#bar_plot-24"><span class="linenos">24</span></a>
</span><span id="bar_plot-25"><a href="#bar_plot-25"><span class="linenos">25</span></a><span class="sd">    Returns : un bar plot</span>
</span><span id="bar_plot-26"><a href="#bar_plot-26"><span class="linenos">26</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="bar_plot-27"><a href="#bar_plot-27"><span class="linenos">27</span></a>
</span><span id="bar_plot-28"><a href="#bar_plot-28"><span class="linenos">28</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">year</span><span class="p">]</span>
</span><span id="bar_plot-29"><a href="#bar_plot-29"><span class="linenos">29</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span>
</span><span id="bar_plot-30"><a href="#bar_plot-30"><span class="linenos">30</span></a>
</span><span id="bar_plot-31"><a href="#bar_plot-31"><span class="linenos">31</span></a>    <span class="c1"># récuperer la signification du codage de la réponse</span>
</span><span id="bar_plot-32"><a href="#bar_plot-32"><span class="linenos">32</span></a>    <span class="n">responde_str</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Response Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="bar_plot-33"><a href="#bar_plot-33"><span class="linenos">33</span></a>    <span class="n">code_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">responde_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;||&#39;</span><span class="p">))</span>
</span><span id="bar_plot-34"><a href="#bar_plot-34"><span class="linenos">34</span></a>    <span class="n">question_text</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="bar_plot-35"><a href="#bar_plot-35"><span class="linenos">35</span></a>
</span><span id="bar_plot-36"><a href="#bar_plot-36"><span class="linenos">36</span></a>    <span class="c1"># eviter l&#39;affichage d&#39;un warning lié au ticks</span>
</span><span id="bar_plot-37"><a href="#bar_plot-37"><span class="linenos">37</span></a>    <span class="n">ticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
</span><span id="bar_plot-38"><a href="#bar_plot-38"><span class="linenos">38</span></a>    <span class="n">old_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
</span><span id="bar_plot-39"><a href="#bar_plot-39"><span class="linenos">39</span></a>
</span><span id="bar_plot-40"><a href="#bar_plot-40"><span class="linenos">40</span></a>    <span class="c1"># on utilise le dictionnaire pour un affichage lisible</span>
</span><span id="bar_plot-41"><a href="#bar_plot-41"><span class="linenos">41</span></a>    <span class="n">new_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">code_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">old_labels</span><span class="p">]</span>
</span><span id="bar_plot-42"><a href="#bar_plot-42"><span class="linenos">42</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
</span><span id="bar_plot-43"><a href="#bar_plot-43"><span class="linenos">43</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">new_labels</span><span class="p">)</span>
</span><span id="bar_plot-44"><a href="#bar_plot-44"><span class="linenos">44</span></a>
</span><span id="bar_plot-45"><a href="#bar_plot-45"><span class="linenos">45</span></a>    <span class="c1"># pivoter les labels</span>
</span><span id="bar_plot-46"><a href="#bar_plot-46"><span class="linenos">46</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="bar_plot-47"><a href="#bar_plot-47"><span class="linenos">47</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Réponse&quot;</span><span class="p">)</span>
</span><span id="bar_plot-48"><a href="#bar_plot-48"><span class="linenos">48</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Effectif&quot;</span><span class="p">)</span>
</span><span id="bar_plot-49"><a href="#bar_plot-49"><span class="linenos">49</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Répartition de la variable d&#39;intérêt </span><span class="se">\n</span><span class="si">{</span><span class="n">question_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="bar_plot-50"><a href="#bar_plot-50"><span class="linenos">50</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Réaliser un bar plot.</p>

<p>Args :
    year (str) : années d'intéret
    dfs (dict) : dictionnaire des bases de données
    variable (str) : Le critère de regroupement.
    guide (pd object) : Le guide des variables NSCH.</p>

<p>Returns : un bar plot</p>
</div>


                </section>
                <section id="mca_analysis">
                            <input id="mca_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mca_analysis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">year</span>, </span><span class="param"><span class="n">dfs</span>, </span><span class="param"><span class="n">drop_columns</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mca_analysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mca_analysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mca_analysis-53"><a href="#mca_analysis-53"><span class="linenos">53</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_analysis</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">drop_columns</span><span class="p">):</span>
</span><span id="mca_analysis-54"><a href="#mca_analysis-54"><span class="linenos">54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="mca_analysis-55"><a href="#mca_analysis-55"><span class="linenos">55</span></a><span class="sd">    Réaliser une ACM.</span>
</span><span id="mca_analysis-56"><a href="#mca_analysis-56"><span class="linenos">56</span></a>
</span><span id="mca_analysis-57"><a href="#mca_analysis-57"><span class="linenos">57</span></a><span class="sd">    Args:</span>
</span><span id="mca_analysis-58"><a href="#mca_analysis-58"><span class="linenos">58</span></a><span class="sd">        year (str): L&#39;année du formulaire.</span>
</span><span id="mca_analysis-59"><a href="#mca_analysis-59"><span class="linenos">59</span></a><span class="sd">        dfs (dict): Le dictionnaire des bases des formulaires NSCH.</span>
</span><span id="mca_analysis-60"><a href="#mca_analysis-60"><span class="linenos">60</span></a><span class="sd">        drop_columns (list) : La liste des colonnes à filtrer.</span>
</span><span id="mca_analysis-61"><a href="#mca_analysis-61"><span class="linenos">61</span></a>
</span><span id="mca_analysis-62"><a href="#mca_analysis-62"><span class="linenos">62</span></a><span class="sd">    Returns:</span>
</span><span id="mca_analysis-63"><a href="#mca_analysis-63"><span class="linenos">63</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="mca_analysis-64"><a href="#mca_analysis-64"><span class="linenos">64</span></a><span class="sd">        mca : Objet mca.</span>
</span><span id="mca_analysis-65"><a href="#mca_analysis-65"><span class="linenos">65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mca_analysis-66"><a href="#mca_analysis-66"><span class="linenos">66</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">year</span><span class="p">]</span>
</span><span id="mca_analysis-67"><a href="#mca_analysis-67"><span class="linenos">67</span></a>    <span class="n">df_mca</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">drop_columns</span><span class="p">])</span>
</span><span id="mca_analysis-68"><a href="#mca_analysis-68"><span class="linenos">68</span></a>    <span class="n">df_mca</span> <span class="o">=</span> <span class="n">df_mca</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_mca</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;imputed&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span>
</span><span id="mca_analysis-69"><a href="#mca_analysis-69"><span class="linenos">69</span></a>
</span><span id="mca_analysis-70"><a href="#mca_analysis-70"><span class="linenos">70</span></a>    <span class="n">mca</span> <span class="o">=</span> <span class="n">prince</span><span class="o">.</span><span class="n">MCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="mca_analysis-71"><a href="#mca_analysis-71"><span class="linenos">71</span></a>    <span class="k">return</span> <span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span>
</span></pre></div>


            <div class="docstring"><p>Réaliser une ACM.</p>

<p>Args:
    year (str): L'année du formulaire.
    dfs (dict): Le dictionnaire des bases des formulaires NSCH.
    drop_columns (list) : La liste des colonnes à filtrer.</p>

<p>Returns:
    df_mca : La base de données adéquate pour réaliser l'ACM.
    mca : Objet mca.</p>
</div>


                </section>
                <section id="mca_plot_individuals">
                            <input id="mca_plot_individuals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mca_plot_individuals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df_mca</span>, </span><span class="param"><span class="n">mca</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mca_plot_individuals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mca_plot_individuals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mca_plot_individuals-74"><a href="#mca_plot_individuals-74"><span class="linenos"> 74</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_plot_individuals</span><span class="p">(</span><span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span><span class="p">):</span>
</span><span id="mca_plot_individuals-75"><a href="#mca_plot_individuals-75"><span class="linenos"> 75</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="mca_plot_individuals-76"><a href="#mca_plot_individuals-76"><span class="linenos"> 76</span></a><span class="sd">    Visualisation des individus de la base de données dans un plan 2D.</span>
</span><span id="mca_plot_individuals-77"><a href="#mca_plot_individuals-77"><span class="linenos"> 77</span></a>
</span><span id="mca_plot_individuals-78"><a href="#mca_plot_individuals-78"><span class="linenos"> 78</span></a><span class="sd">    Args:</span>
</span><span id="mca_plot_individuals-79"><a href="#mca_plot_individuals-79"><span class="linenos"> 79</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="mca_plot_individuals-80"><a href="#mca_plot_individuals-80"><span class="linenos"> 80</span></a><span class="sd">        mca : L&#39;objet mca.</span>
</span><span id="mca_plot_individuals-81"><a href="#mca_plot_individuals-81"><span class="linenos"> 81</span></a>
</span><span id="mca_plot_individuals-82"><a href="#mca_plot_individuals-82"><span class="linenos"> 82</span></a><span class="sd">    Returns:</span>
</span><span id="mca_plot_individuals-83"><a href="#mca_plot_individuals-83"><span class="linenos"> 83</span></a><span class="sd">        génération d&#39;un plot (pas de return explicite)</span>
</span><span id="mca_plot_individuals-84"><a href="#mca_plot_individuals-84"><span class="linenos"> 84</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mca_plot_individuals-85"><a href="#mca_plot_individuals-85"><span class="linenos"> 85</span></a>    <span class="n">row_coords</span> <span class="o">=</span> <span class="n">mca</span><span class="o">.</span><span class="n">row_coordinates</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="mca_plot_individuals-86"><a href="#mca_plot_individuals-86"><span class="linenos"> 86</span></a>
</span><span id="mca_plot_individuals-87"><a href="#mca_plot_individuals-87"><span class="linenos"> 87</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="mca_plot_individuals-88"><a href="#mca_plot_individuals-88"><span class="linenos"> 88</span></a>
</span><span id="mca_plot_individuals-89"><a href="#mca_plot_individuals-89"><span class="linenos"> 89</span></a>    <span class="c1"># Scatter plot</span>
</span><span id="mca_plot_individuals-90"><a href="#mca_plot_individuals-90"><span class="linenos"> 90</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="mca_plot_individuals-91"><a href="#mca_plot_individuals-91"><span class="linenos"> 91</span></a>        <span class="n">row_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="mca_plot_individuals-92"><a href="#mca_plot_individuals-92"><span class="linenos"> 92</span></a>        <span class="n">row_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="mca_plot_individuals-93"><a href="#mca_plot_individuals-93"><span class="linenos"> 93</span></a>        <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>        <span class="c1"># taille des points</span>
</span><span id="mca_plot_individuals-94"><a href="#mca_plot_individuals-94"><span class="linenos"> 94</span></a>        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>   <span class="c1"># transparence pour zones denses</span>
</span><span id="mca_plot_individuals-95"><a href="#mca_plot_individuals-95"><span class="linenos"> 95</span></a>        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
</span><span id="mca_plot_individuals-96"><a href="#mca_plot_individuals-96"><span class="linenos"> 96</span></a>        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Individus&#39;</span>
</span><span id="mca_plot_individuals-97"><a href="#mca_plot_individuals-97"><span class="linenos"> 97</span></a>    <span class="p">)</span>
</span><span id="mca_plot_individuals-98"><a href="#mca_plot_individuals-98"><span class="linenos"> 98</span></a>
</span><span id="mca_plot_individuals-99"><a href="#mca_plot_individuals-99"><span class="linenos"> 99</span></a>    <span class="c1"># Labels et titre</span>
</span><span id="mca_plot_individuals-100"><a href="#mca_plot_individuals-100"><span class="linenos">100</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="mca_plot_individuals-101"><a href="#mca_plot_individuals-101"><span class="linenos">101</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="mca_plot_individuals-102"><a href="#mca_plot_individuals-102"><span class="linenos">102</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Analyse en Composantes Multiples, Individus&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="mca_plot_individuals-103"><a href="#mca_plot_individuals-103"><span class="linenos">103</span></a>
</span><span id="mca_plot_individuals-104"><a href="#mca_plot_individuals-104"><span class="linenos">104</span></a>    <span class="c1"># Pour une grille</span>
</span><span id="mca_plot_individuals-105"><a href="#mca_plot_individuals-105"><span class="linenos">105</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="mca_plot_individuals-106"><a href="#mca_plot_individuals-106"><span class="linenos">106</span></a>
</span><span id="mca_plot_individuals-107"><a href="#mca_plot_individuals-107"><span class="linenos">107</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="mca_plot_individuals-108"><a href="#mca_plot_individuals-108"><span class="linenos">108</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Visualisation des individus de la base de données dans un plan 2D.</p>

<p>Args:
    df_mca : La base de données adéquate pour réaliser l'ACM.
    mca : L'objet mca.</p>

<p>Returns:
    génération d'un plot (pas de return explicite)</p>
</div>


                </section>
                <section id="mca_plot_individuals_group">
                            <input id="mca_plot_individuals_group-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mca_plot_individuals_group</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df_mca</span>, </span><span class="param"><span class="n">mca</span>, </span><span class="param"><span class="n">variable</span>, </span><span class="param"><span class="n">guide</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mca_plot_individuals_group-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mca_plot_individuals_group"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mca_plot_individuals_group-111"><a href="#mca_plot_individuals_group-111"><span class="linenos">111</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_plot_individuals_group</span><span class="p">(</span><span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">guide</span><span class="p">):</span>
</span><span id="mca_plot_individuals_group-112"><a href="#mca_plot_individuals_group-112"><span class="linenos">112</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="mca_plot_individuals_group-113"><a href="#mca_plot_individuals_group-113"><span class="linenos">113</span></a><span class="sd">    Visualisation des individus selon un critère de regroument.</span>
</span><span id="mca_plot_individuals_group-114"><a href="#mca_plot_individuals_group-114"><span class="linenos">114</span></a>
</span><span id="mca_plot_individuals_group-115"><a href="#mca_plot_individuals_group-115"><span class="linenos">115</span></a><span class="sd">    Args:</span>
</span><span id="mca_plot_individuals_group-116"><a href="#mca_plot_individuals_group-116"><span class="linenos">116</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="mca_plot_individuals_group-117"><a href="#mca_plot_individuals_group-117"><span class="linenos">117</span></a><span class="sd">        mca : L&#39;objet mca.</span>
</span><span id="mca_plot_individuals_group-118"><a href="#mca_plot_individuals_group-118"><span class="linenos">118</span></a><span class="sd">        variable (str) : Le critère de regroupement.</span>
</span><span id="mca_plot_individuals_group-119"><a href="#mca_plot_individuals_group-119"><span class="linenos">119</span></a><span class="sd">        guide (pd object) : Le guide des variables NSCH.</span>
</span><span id="mca_plot_individuals_group-120"><a href="#mca_plot_individuals_group-120"><span class="linenos">120</span></a>
</span><span id="mca_plot_individuals_group-121"><a href="#mca_plot_individuals_group-121"><span class="linenos">121</span></a><span class="sd">    Returns:</span>
</span><span id="mca_plot_individuals_group-122"><a href="#mca_plot_individuals_group-122"><span class="linenos">122</span></a><span class="sd">        génération d&#39;un plot (pas de return explicite)</span>
</span><span id="mca_plot_individuals_group-123"><a href="#mca_plot_individuals_group-123"><span class="linenos">123</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mca_plot_individuals_group-124"><a href="#mca_plot_individuals_group-124"><span class="linenos">124</span></a>    <span class="n">row_coords</span> <span class="o">=</span> <span class="n">mca</span><span class="o">.</span><span class="n">row_coordinates</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-125"><a href="#mca_plot_individuals_group-125"><span class="linenos">125</span></a>    <span class="n">groups</span> <span class="o">=</span> <span class="n">df_mca</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</span><span id="mca_plot_individuals_group-126"><a href="#mca_plot_individuals_group-126"><span class="linenos">126</span></a>    <span class="c1"># Les variables sont catégorielles et la légende se présente sous forme d&#39;un str</span>
</span><span id="mca_plot_individuals_group-127"><a href="#mca_plot_individuals_group-127"><span class="linenos">127</span></a>    <span class="c1"># format : ciffre1 = ... || chiffre2 = ...</span>
</span><span id="mca_plot_individuals_group-128"><a href="#mca_plot_individuals_group-128"><span class="linenos">128</span></a>    <span class="n">responde_str</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Response Code&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="mca_plot_individuals_group-129"><a href="#mca_plot_individuals_group-129"><span class="linenos">129</span></a>    <span class="n">code_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">responde_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;||&#39;</span><span class="p">))</span>
</span><span id="mca_plot_individuals_group-130"><a href="#mca_plot_individuals_group-130"><span class="linenos">130</span></a>
</span><span id="mca_plot_individuals_group-131"><a href="#mca_plot_individuals_group-131"><span class="linenos">131</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="mca_plot_individuals_group-132"><a href="#mca_plot_individuals_group-132"><span class="linenos">132</span></a>    <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>
</span><span id="mca_plot_individuals_group-133"><a href="#mca_plot_individuals_group-133"><span class="linenos">133</span></a>
</span><span id="mca_plot_individuals_group-134"><a href="#mca_plot_individuals_group-134"><span class="linenos">134</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
</span><span id="mca_plot_individuals_group-135"><a href="#mca_plot_individuals_group-135"><span class="linenos">135</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_mca</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-136"><a href="#mca_plot_individuals_group-136"><span class="linenos">136</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">row_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
</span><span id="mca_plot_individuals_group-137"><a href="#mca_plot_individuals_group-137"><span class="linenos">137</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">row_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
</span><span id="mca_plot_individuals_group-138"><a href="#mca_plot_individuals_group-138"><span class="linenos">138</span></a>        <span class="c1"># Scatter plot par groupe</span>
</span><span id="mca_plot_individuals_group-139"><a href="#mca_plot_individuals_group-139"><span class="linenos">139</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">code_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
</span><span id="mca_plot_individuals_group-140"><a href="#mca_plot_individuals_group-140"><span class="linenos">140</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-141"><a href="#mca_plot_individuals_group-141"><span class="linenos">141</span></a>        <span class="c1"># code adapté depuis internet pour manipuler les ellipses</span>
</span><span id="mca_plot_individuals_group-142"><a href="#mca_plot_individuals_group-142"><span class="linenos">142</span></a>        <span class="c1"># Ellipse pour montrer un regroupement des individus</span>
</span><span id="mca_plot_individuals_group-143"><a href="#mca_plot_individuals_group-143"><span class="linenos">143</span></a>        <span class="c1"># plus d&#39;un individu</span>
</span><span id="mca_plot_individuals_group-144"><a href="#mca_plot_individuals_group-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="mca_plot_individuals_group-145"><a href="#mca_plot_individuals_group-145"><span class="linenos">145</span></a>            <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-146"><a href="#mca_plot_individuals_group-146"><span class="linenos">146</span></a>            <span class="c1"># calcule les valeurs propres (vals) et vecteurs propres (vecs) d’une matrice symétrique</span>
</span><span id="mca_plot_individuals_group-147"><a href="#mca_plot_individuals_group-147"><span class="linenos">147</span></a>            <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-148"><a href="#mca_plot_individuals_group-148"><span class="linenos">148</span></a>            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># facteur 2 pour agrandir ellipse</span>
</span><span id="mca_plot_individuals_group-149"><a href="#mca_plot_individuals_group-149"><span class="linenos">149</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">*</span><span class="n">vecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="mca_plot_individuals_group-150"><a href="#mca_plot_individuals_group-150"><span class="linenos">150</span></a>            <span class="n">ell</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span>
</span><span id="mca_plot_individuals_group-151"><a href="#mca_plot_individuals_group-151"><span class="linenos">151</span></a>                          <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="mca_plot_individuals_group-152"><a href="#mca_plot_individuals_group-152"><span class="linenos">152</span></a>                          <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span>
</span><span id="mca_plot_individuals_group-153"><a href="#mca_plot_individuals_group-153"><span class="linenos">153</span></a>                          <span class="n">color</span><span class="o">=</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-154"><a href="#mca_plot_individuals_group-154"><span class="linenos">154</span></a>            <span class="c1"># GCA = Get Current Axes</span>
</span><span id="mca_plot_individuals_group-155"><a href="#mca_plot_individuals_group-155"><span class="linenos">155</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ell</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-156"><a href="#mca_plot_individuals_group-156"><span class="linenos">156</span></a>
</span><span id="mca_plot_individuals_group-157"><a href="#mca_plot_individuals_group-157"><span class="linenos">157</span></a>    <span class="c1"># Récupération du texte de la question pour le titre</span>
</span><span id="mca_plot_individuals_group-158"><a href="#mca_plot_individuals_group-158"><span class="linenos">158</span></a>    <span class="n">question_text</span> <span class="o">=</span> <span class="n">guide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">guide</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">variable</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="mca_plot_individuals_group-159"><a href="#mca_plot_individuals_group-159"><span class="linenos">159</span></a>
</span><span id="mca_plot_individuals_group-160"><a href="#mca_plot_individuals_group-160"><span class="linenos">160</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-161"><a href="#mca_plot_individuals_group-161"><span class="linenos">161</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-162"><a href="#mca_plot_individuals_group-162"><span class="linenos">162</span></a>
</span><span id="mca_plot_individuals_group-163"><a href="#mca_plot_individuals_group-163"><span class="linenos">163</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ACM des individus par groupe: </span><span class="se">\n</span><span class="si">{</span><span class="n">question_text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="mca_plot_individuals_group-164"><a href="#mca_plot_individuals_group-164"><span class="linenos">164</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="mca_plot_individuals_group-165"><a href="#mca_plot_individuals_group-165"><span class="linenos">165</span></a>
</span><span id="mca_plot_individuals_group-166"><a href="#mca_plot_individuals_group-166"><span class="linenos">166</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="mca_plot_individuals_group-167"><a href="#mca_plot_individuals_group-167"><span class="linenos">167</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Visualisation des individus selon un critère de regroument.</p>

<p>Args:
    df_mca : La base de données adéquate pour réaliser l'ACM.
    mca : L'objet mca.
    variable (str) : Le critère de regroupement.
    guide (pd object) : Le guide des variables NSCH.</p>

<p>Returns:
    génération d'un plot (pas de return explicite)</p>
</div>


                </section>
                <section id="mca_plot_categories">
                            <input id="mca_plot_categories-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mca_plot_categories</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df_mca</span>, </span><span class="param"><span class="n">mca</span>, </span><span class="param"><span class="n">seuil</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mca_plot_categories-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mca_plot_categories"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mca_plot_categories-170"><a href="#mca_plot_categories-170"><span class="linenos">170</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mca_plot_categories</span><span class="p">(</span><span class="n">df_mca</span><span class="p">,</span> <span class="n">mca</span><span class="p">,</span> <span class="n">seuil</span><span class="p">):</span>
</span><span id="mca_plot_categories-171"><a href="#mca_plot_categories-171"><span class="linenos">171</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="mca_plot_categories-172"><a href="#mca_plot_categories-172"><span class="linenos">172</span></a><span class="sd">    Visualisation des modalités (variables catégorielles) de la base de données dans un plan 2D.</span>
</span><span id="mca_plot_categories-173"><a href="#mca_plot_categories-173"><span class="linenos">173</span></a>
</span><span id="mca_plot_categories-174"><a href="#mca_plot_categories-174"><span class="linenos">174</span></a><span class="sd">    Args:</span>
</span><span id="mca_plot_categories-175"><a href="#mca_plot_categories-175"><span class="linenos">175</span></a><span class="sd">        df_mca : La base de données adéquate pour réaliser l&#39;ACM.</span>
</span><span id="mca_plot_categories-176"><a href="#mca_plot_categories-176"><span class="linenos">176</span></a><span class="sd">        mca : L&#39;objet mca.</span>
</span><span id="mca_plot_categories-177"><a href="#mca_plot_categories-177"><span class="linenos">177</span></a><span class="sd">        seuil (int) : Pour mieux visualiser le graphique, combien de composantes &quot;principales&quot;.</span>
</span><span id="mca_plot_categories-178"><a href="#mca_plot_categories-178"><span class="linenos">178</span></a>
</span><span id="mca_plot_categories-179"><a href="#mca_plot_categories-179"><span class="linenos">179</span></a><span class="sd">    Returns:</span>
</span><span id="mca_plot_categories-180"><a href="#mca_plot_categories-180"><span class="linenos">180</span></a><span class="sd">        génération d&#39;une figure avec 2 plot (pas de return explicite)</span>
</span><span id="mca_plot_categories-181"><a href="#mca_plot_categories-181"><span class="linenos">181</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mca_plot_categories-182"><a href="#mca_plot_categories-182"><span class="linenos">182</span></a>    <span class="c1"># Pour les modalités, le graphique est très dense</span>
</span><span id="mca_plot_categories-183"><a href="#mca_plot_categories-183"><span class="linenos">183</span></a>    <span class="c1"># La longueur de la flèche indique l’importance de cette modalité dans l’espace MCA</span>
</span><span id="mca_plot_categories-184"><a href="#mca_plot_categories-184"><span class="linenos">184</span></a>    <span class="c1"># plus la flèche est longue, plus cette modalité contribue à la variance</span>
</span><span id="mca_plot_categories-185"><a href="#mca_plot_categories-185"><span class="linenos">185</span></a>    <span class="c1"># des premières dimensions.</span>
</span><span id="mca_plot_categories-186"><a href="#mca_plot_categories-186"><span class="linenos">186</span></a>    <span class="n">column_coords</span> <span class="o">=</span> <span class="n">mca</span><span class="o">.</span><span class="n">column_coordinates</span><span class="p">(</span><span class="n">df_mca</span><span class="p">)</span>
</span><span id="mca_plot_categories-187"><a href="#mca_plot_categories-187"><span class="linenos">187</span></a>
</span><span id="mca_plot_categories-188"><a href="#mca_plot_categories-188"><span class="linenos">188</span></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">column_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">column_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="mca_plot_categories-189"><a href="#mca_plot_categories-189"><span class="linenos">189</span></a>    <span class="n">top</span> <span class="o">=</span> <span class="n">distances</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">seuil</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
</span><span id="mca_plot_categories-190"><a href="#mca_plot_categories-190"><span class="linenos">190</span></a>    <span class="n">principales</span> <span class="o">=</span> <span class="n">column_coords</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">top</span><span class="p">]</span>
</span><span id="mca_plot_categories-191"><a href="#mca_plot_categories-191"><span class="linenos">191</span></a>    <span class="n">secondaires</span> <span class="o">=</span> <span class="n">column_coords</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</span><span id="mca_plot_categories-192"><a href="#mca_plot_categories-192"><span class="linenos">192</span></a>
</span><span id="mca_plot_categories-193"><a href="#mca_plot_categories-193"><span class="linenos">193</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  <span class="c1"># 1 ligne, 2 plots</span>
</span><span id="mca_plot_categories-194"><a href="#mca_plot_categories-194"><span class="linenos">194</span></a>
</span><span id="mca_plot_categories-195"><a href="#mca_plot_categories-195"><span class="linenos">195</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="mca_plot_categories-196"><a href="#mca_plot_categories-196"><span class="linenos">196</span></a>    <span class="c1"># Plot n°1</span>
</span><span id="mca_plot_categories-197"><a href="#mca_plot_categories-197"><span class="linenos">197</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="mca_plot_categories-198"><a href="#mca_plot_categories-198"><span class="linenos">198</span></a>
</span><span id="mca_plot_categories-199"><a href="#mca_plot_categories-199"><span class="linenos">199</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="mca_plot_categories-200"><a href="#mca_plot_categories-200"><span class="linenos">200</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">principales</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
</span><span id="mca_plot_categories-201"><a href="#mca_plot_categories-201"><span class="linenos">201</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">principales</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">principales</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="mca_plot_categories-202"><a href="#mca_plot_categories-202"><span class="linenos">202</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</span><span id="mca_plot_categories-203"><a href="#mca_plot_categories-203"><span class="linenos">203</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="mca_plot_categories-204"><a href="#mca_plot_categories-204"><span class="linenos">204</span></a>
</span><span id="mca_plot_categories-205"><a href="#mca_plot_categories-205"><span class="linenos">205</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">)</span>
</span><span id="mca_plot_categories-206"><a href="#mca_plot_categories-206"><span class="linenos">206</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">)</span>
</span><span id="mca_plot_categories-207"><a href="#mca_plot_categories-207"><span class="linenos">207</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Modalités principales&#39;</span><span class="p">)</span>
</span><span id="mca_plot_categories-208"><a href="#mca_plot_categories-208"><span class="linenos">208</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="mca_plot_categories-209"><a href="#mca_plot_categories-209"><span class="linenos">209</span></a>
</span><span id="mca_plot_categories-210"><a href="#mca_plot_categories-210"><span class="linenos">210</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="mca_plot_categories-211"><a href="#mca_plot_categories-211"><span class="linenos">211</span></a>    <span class="c1"># Plot n°2</span>
</span><span id="mca_plot_categories-212"><a href="#mca_plot_categories-212"><span class="linenos">212</span></a>    <span class="c1"># ---------------------------</span>
</span><span id="mca_plot_categories-213"><a href="#mca_plot_categories-213"><span class="linenos">213</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mca_plot_categories-214"><a href="#mca_plot_categories-214"><span class="linenos">214</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">secondaires</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
</span><span id="mca_plot_categories-215"><a href="#mca_plot_categories-215"><span class="linenos">215</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">secondaires</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">secondaires</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="mca_plot_categories-216"><a href="#mca_plot_categories-216"><span class="linenos">216</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="mca_plot_categories-217"><a href="#mca_plot_categories-217"><span class="linenos">217</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="mca_plot_categories-218"><a href="#mca_plot_categories-218"><span class="linenos">218</span></a>
</span><span id="mca_plot_categories-219"><a href="#mca_plot_categories-219"><span class="linenos">219</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Dimension 0&#39;</span><span class="p">)</span>
</span><span id="mca_plot_categories-220"><a href="#mca_plot_categories-220"><span class="linenos">220</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dimension 1&#39;</span><span class="p">)</span>
</span><span id="mca_plot_categories-221"><a href="#mca_plot_categories-221"><span class="linenos">221</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Modalités restantes&#39;</span><span class="p">)</span>
</span><span id="mca_plot_categories-222"><a href="#mca_plot_categories-222"><span class="linenos">222</span></a>    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="mca_plot_categories-223"><a href="#mca_plot_categories-223"><span class="linenos">223</span></a>
</span><span id="mca_plot_categories-224"><a href="#mca_plot_categories-224"><span class="linenos">224</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="mca_plot_categories-225"><a href="#mca_plot_categories-225"><span class="linenos">225</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Visualisation des modalités (variables catégorielles) de la base de données dans un plan 2D.</p>

<p>Args:
    df_mca : La base de données adéquate pour réaliser l'ACM.
    mca : L'objet mca.
    seuil (int) : Pour mieux visualiser le graphique, combien de composantes "principales".</p>

<p>Returns:
    génération d'une figure avec 2 plot (pas de return explicite)</p>
</div>


                </section>
                <section id="heatmap_generator">
                            <input id="heatmap_generator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">heatmap_generator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="heatmap_generator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#heatmap_generator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="heatmap_generator-228"><a href="#heatmap_generator-228"><span class="linenos">228</span></a><span class="k">def</span><span class="w"> </span><span class="nf">heatmap_generator</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="heatmap_generator-229"><a href="#heatmap_generator-229"><span class="linenos">229</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="heatmap_generator-230"><a href="#heatmap_generator-230"><span class="linenos">230</span></a><span class="sd">    Visualisation de la matrice des corrélations de façon hierarchique.</span>
</span><span id="heatmap_generator-231"><a href="#heatmap_generator-231"><span class="linenos">231</span></a>
</span><span id="heatmap_generator-232"><a href="#heatmap_generator-232"><span class="linenos">232</span></a><span class="sd">    Args:</span>
</span><span id="heatmap_generator-233"><a href="#heatmap_generator-233"><span class="linenos">233</span></a><span class="sd">        df : La base de données.</span>
</span><span id="heatmap_generator-234"><a href="#heatmap_generator-234"><span class="linenos">234</span></a>
</span><span id="heatmap_generator-235"><a href="#heatmap_generator-235"><span class="linenos">235</span></a><span class="sd">    Returns:</span>
</span><span id="heatmap_generator-236"><a href="#heatmap_generator-236"><span class="linenos">236</span></a><span class="sd">        génération d&#39;un plot (pas de return explicite)</span>
</span><span id="heatmap_generator-237"><a href="#heatmap_generator-237"><span class="linenos">237</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="heatmap_generator-238"><a href="#heatmap_generator-238"><span class="linenos">238</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</span><span id="heatmap_generator-239"><a href="#heatmap_generator-239"><span class="linenos">239</span></a>
</span><span id="heatmap_generator-240"><a href="#heatmap_generator-240"><span class="linenos">240</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>  <span class="c1"># style propre</span>
</span><span id="heatmap_generator-241"><a href="#heatmap_generator-241"><span class="linenos">241</span></a>
</span><span id="heatmap_generator-242"><a href="#heatmap_generator-242"><span class="linenos">242</span></a>    <span class="c1"># Clustermap =&gt; Un clustering hiérarchique</span>
</span><span id="heatmap_generator-243"><a href="#heatmap_generator-243"><span class="linenos">243</span></a>    <span class="c1"># Il regroupe automatiquement les variables qui se ressemblent le plus.</span>
</span><span id="heatmap_generator-244"><a href="#heatmap_generator-244"><span class="linenos">244</span></a>    <span class="c1"># Un réarrangement automatique des lignes et colonnes</span>
</span><span id="heatmap_generator-245"><a href="#heatmap_generator-245"><span class="linenos">245</span></a>    <span class="c1"># Pour mettre ensemble les variables ayant un comportement similaire.</span>
</span><span id="heatmap_generator-246"><a href="#heatmap_generator-246"><span class="linenos">246</span></a>
</span><span id="heatmap_generator-247"><a href="#heatmap_generator-247"><span class="linenos">247</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span>
</span><span id="heatmap_generator-248"><a href="#heatmap_generator-248"><span class="linenos">248</span></a>        <span class="n">matrix</span><span class="p">,</span>
</span><span id="heatmap_generator-249"><a href="#heatmap_generator-249"><span class="linenos">249</span></a>        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
</span><span id="heatmap_generator-250"><a href="#heatmap_generator-250"><span class="linenos">250</span></a>        <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="heatmap_generator-251"><a href="#heatmap_generator-251"><span class="linenos">251</span></a>        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="heatmap_generator-252"><a href="#heatmap_generator-252"><span class="linenos">252</span></a>        <span class="c1"># masquer la valeur de la corrélation</span>
</span><span id="heatmap_generator-253"><a href="#heatmap_generator-253"><span class="linenos">253</span></a>        <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="heatmap_generator-254"><a href="#heatmap_generator-254"><span class="linenos">254</span></a>        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
</span><span id="heatmap_generator-255"><a href="#heatmap_generator-255"><span class="linenos">255</span></a>        <span class="n">dendrogram_ratio</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>  <span class="c1"># taille des dendrogrammes - l&#39;arrangement de groupes générés</span>
</span><span id="heatmap_generator-256"><a href="#heatmap_generator-256"><span class="linenos">256</span></a>        <span class="n">cbar_pos</span><span class="o">=</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">),</span>  <span class="c1"># position de la barre de couleur</span>
</span><span id="heatmap_generator-257"><a href="#heatmap_generator-257"><span class="linenos">257</span></a>        <span class="n">robust</span><span class="o">=</span><span class="kc">True</span>          <span class="c1"># évite que des valeurs extrêmes dominent l&#39;affichage</span>
</span><span id="heatmap_generator-258"><a href="#heatmap_generator-258"><span class="linenos">258</span></a>    <span class="p">)</span>
</span><span id="heatmap_generator-259"><a href="#heatmap_generator-259"><span class="linenos">259</span></a>
</span><span id="heatmap_generator-260"><a href="#heatmap_generator-260"><span class="linenos">260</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Clustermap de la matrice de corrélation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
</span><span id="heatmap_generator-261"><a href="#heatmap_generator-261"><span class="linenos">261</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Visualisation de la matrice des corrélations de façon hierarchique.</p>

<p>Args:
    df : La base de données.</p>

<p>Returns:
    génération d'un plot (pas de return explicite)</p>
</div>


                </section>
                <section id="map_united_states">
                            <input id="map_united_states-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_united_states</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df_indicator</span>, </span><span class="param"><span class="n">df_geo</span>, </span><span class="param"><span class="n">year</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="map_united_states-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#map_united_states"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="map_united_states-264"><a href="#map_united_states-264"><span class="linenos">264</span></a><span class="k">def</span><span class="w"> </span><span class="nf">map_united_states</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
</span><span id="map_united_states-265"><a href="#map_united_states-265"><span class="linenos">265</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="map_united_states-266"><a href="#map_united_states-266"><span class="linenos">266</span></a><span class="sd">    Crée une carte choroplèthe interactive des États-Unis représentant</span>
</span><span id="map_united_states-267"><a href="#map_united_states-267"><span class="linenos">267</span></a><span class="sd">    un indicateur global de santé des enfants pour une année donnée.</span>
</span><span id="map_united_states-268"><a href="#map_united_states-268"><span class="linenos">268</span></a>
</span><span id="map_united_states-269"><a href="#map_united_states-269"><span class="linenos">269</span></a><span class="sd">    La carte est générée à l’aide de Folium à partir de données géographiques</span>
</span><span id="map_united_states-270"><a href="#map_united_states-270"><span class="linenos">270</span></a><span class="sd">    (GeoDataFrame) et d’un DataFrame contenant les indicateurs de santé.</span>
</span><span id="map_united_states-271"><a href="#map_united_states-271"><span class="linenos">271</span></a><span class="sd">    Chaque État est coloré selon la valeur de l’indicateur, allant du rouge</span>
</span><span id="map_united_states-272"><a href="#map_united_states-272"><span class="linenos">272</span></a><span class="sd">    (faible niveau de santé) au vert foncé (meilleur niveau de santé).</span>
</span><span id="map_united_states-273"><a href="#map_united_states-273"><span class="linenos">273</span></a>
</span><span id="map_united_states-274"><a href="#map_united_states-274"><span class="linenos">274</span></a><span class="sd">    Args:</span>
</span><span id="map_united_states-275"><a href="#map_united_states-275"><span class="linenos">275</span></a><span class="sd">        df_indicator : pandas.DataFrame</span>
</span><span id="map_united_states-276"><a href="#map_united_states-276"><span class="linenos">276</span></a><span class="sd">            DataFrame contenant l&#39;indicateur de santé par État.</span>
</span><span id="map_united_states-277"><a href="#map_united_states-277"><span class="linenos">277</span></a><span class="sd">            L&#39;index doit correspondre au code FIPS des États (FIPSST).</span>
</span><span id="map_united_states-278"><a href="#map_united_states-278"><span class="linenos">278</span></a><span class="sd">            Il doit contenir une colonne nommée :</span>
</span><span id="map_united_states-279"><a href="#map_united_states-279"><span class="linenos">279</span></a><span class="sd">            &quot;indicator_global_health_&lt;year&gt;&quot;.</span>
</span><span id="map_united_states-280"><a href="#map_united_states-280"><span class="linenos">280</span></a>
</span><span id="map_united_states-281"><a href="#map_united_states-281"><span class="linenos">281</span></a><span class="sd">        df_geo : geopandas.GeoDataFrame</span>
</span><span id="map_united_states-282"><a href="#map_united_states-282"><span class="linenos">282</span></a><span class="sd">            GeoDataFrame contenant les polygones des États américains.</span>
</span><span id="map_united_states-283"><a href="#map_united_states-283"><span class="linenos">283</span></a><span class="sd">            Doit inclure les colonnes :</span>
</span><span id="map_united_states-284"><a href="#map_united_states-284"><span class="linenos">284</span></a><span class="sd">            - &quot;GeoFIPS&quot; : code FIPS sous forme de chaîne</span>
</span><span id="map_united_states-285"><a href="#map_united_states-285"><span class="linenos">285</span></a><span class="sd">            - &quot;GeoName&quot; : nom de l&#39;État</span>
</span><span id="map_united_states-286"><a href="#map_united_states-286"><span class="linenos">286</span></a><span class="sd">            - &quot;geometry&quot; : géométrie des États</span>
</span><span id="map_united_states-287"><a href="#map_united_states-287"><span class="linenos">287</span></a>
</span><span id="map_united_states-288"><a href="#map_united_states-288"><span class="linenos">288</span></a><span class="sd">        year : str</span>
</span><span id="map_united_states-289"><a href="#map_united_states-289"><span class="linenos">289</span></a><span class="sd">            Année de l&#39;indicateur de santé à afficher sur la carte.</span>
</span><span id="map_united_states-290"><a href="#map_united_states-290"><span class="linenos">290</span></a>
</span><span id="map_united_states-291"><a href="#map_united_states-291"><span class="linenos">291</span></a><span class="sd">    Returns:</span>
</span><span id="map_united_states-292"><a href="#map_united_states-292"><span class="linenos">292</span></a><span class="sd">        folium.Map</span>
</span><span id="map_united_states-293"><a href="#map_united_states-293"><span class="linenos">293</span></a><span class="sd">            Objet Folium représentant la carte interactive des États-Unis,</span>
</span><span id="map_united_states-294"><a href="#map_united_states-294"><span class="linenos">294</span></a><span class="sd">            avec une légende et des infobulles affichant le nom de l&#39;État</span>
</span><span id="map_united_states-295"><a href="#map_united_states-295"><span class="linenos">295</span></a><span class="sd">            et la valeur de l&#39;indicateur de santé.</span>
</span><span id="map_united_states-296"><a href="#map_united_states-296"><span class="linenos">296</span></a>
</span><span id="map_united_states-297"><a href="#map_united_states-297"><span class="linenos">297</span></a><span class="sd">    Références</span>
</span><span id="map_united_states-298"><a href="#map_united_states-298"><span class="linenos">298</span></a><span class="sd">    ----------</span>
</span><span id="map_united_states-299"><a href="#map_united_states-299"><span class="linenos">299</span></a><span class="sd">    Tutoriel Folium utilisé :</span>
</span><span id="map_united_states-300"><a href="#map_united_states-300"><span class="linenos">300</span></a><span class="sd">    https://python-visualization.github.io/folium/latest/user_guide/geojson/geojson_popup_and_tooltip.html</span>
</span><span id="map_united_states-301"><a href="#map_united_states-301"><span class="linenos">301</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="map_united_states-302"><a href="#map_united_states-302"><span class="linenos">302</span></a>
</span><span id="map_united_states-303"><a href="#map_united_states-303"><span class="linenos">303</span></a>    <span class="n">new_df</span> <span class="o">=</span> <span class="n">df_geo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="map_united_states-304"><a href="#map_united_states-304"><span class="linenos">304</span></a>    <span class="n">new_df</span><span class="p">[</span><span class="s2">&quot;FIPSST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_df</span><span class="p">[</span><span class="s2">&quot;GeoFIPS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="map_united_states-305"><a href="#map_united_states-305"><span class="linenos">305</span></a>
</span><span id="map_united_states-306"><a href="#map_united_states-306"><span class="linenos">306</span></a>    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">new_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="map_united_states-307"><a href="#map_united_states-307"><span class="linenos">307</span></a>    <span class="n">df_indicator</span> <span class="o">=</span> <span class="n">df_indicator</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;FIPSST&#39;</span><span class="p">)</span>
</span><span id="map_united_states-308"><a href="#map_united_states-308"><span class="linenos">308</span></a>
</span><span id="map_united_states-309"><a href="#map_united_states-309"><span class="linenos">309</span></a>    <span class="c1"># Merge pour ajouter l&#39;indicateur dans gdf</span>
</span><span id="map_united_states-310"><a href="#map_united_states-310"><span class="linenos">310</span></a>    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;FIPSST&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="map_united_states-311"><a href="#map_united_states-311"><span class="linenos">311</span></a>
</span><span id="map_united_states-312"><a href="#map_united_states-312"><span class="linenos">312</span></a>    <span class="c1"># Centrer la carte sur les USA</span>
</span><span id="map_united_states-313"><a href="#map_united_states-313"><span class="linenos">313</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">([</span><span class="mi">43</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">min_zoom</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_zoom</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</span><span id="map_united_states-314"><a href="#map_united_states-314"><span class="linenos">314</span></a>
</span><span id="map_united_states-315"><a href="#map_united_states-315"><span class="linenos">315</span></a>    <span class="c1"># Créer une échelle de couleur propre : rouge ---&gt; vert</span>
</span><span id="map_united_states-316"><a href="#map_united_states-316"><span class="linenos">316</span></a>    <span class="n">colormap</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">LinearColormap</span><span class="p">(</span>
</span><span id="map_united_states-317"><a href="#map_united_states-317"><span class="linenos">317</span></a>        <span class="n">vmin</span><span class="o">=</span><span class="n">gdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="map_united_states-318"><a href="#map_united_states-318"><span class="linenos">318</span></a>        <span class="n">vmax</span><span class="o">=</span><span class="n">gdf</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="map_united_states-319"><a href="#map_united_states-319"><span class="linenos">319</span></a>        <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;darkgreen&quot;</span><span class="p">],</span>
</span><span id="map_united_states-320"><a href="#map_united_states-320"><span class="linenos">320</span></a>        <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Indice global de santé (0-1) pour l&#39;année </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="map_united_states-321"><a href="#map_united_states-321"><span class="linenos">321</span></a>    <span class="p">)</span>
</span><span id="map_united_states-322"><a href="#map_united_states-322"><span class="linenos">322</span></a>
</span><span id="map_united_states-323"><a href="#map_united_states-323"><span class="linenos">323</span></a>    <span class="c1"># ajout des polygones et des messages</span>
</span><span id="map_united_states-324"><a href="#map_united_states-324"><span class="linenos">324</span></a>    <span class="n">folium</span><span class="o">.</span><span class="n">GeoJson</span><span class="p">(</span>
</span><span id="map_united_states-325"><a href="#map_united_states-325"><span class="linenos">325</span></a>        <span class="n">gdf</span><span class="p">,</span>
</span><span id="map_united_states-326"><a href="#map_united_states-326"><span class="linenos">326</span></a>        <span class="n">style_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">feature</span><span class="p">:</span> <span class="p">{</span>
</span><span id="map_united_states-327"><a href="#map_united_states-327"><span class="linenos">327</span></a>            <span class="s1">&#39;fillColor&#39;</span><span class="p">:</span> <span class="n">colormap</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]),</span>
</span><span id="map_united_states-328"><a href="#map_united_states-328"><span class="linenos">328</span></a>            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span><span id="map_united_states-329"><a href="#map_united_states-329"><span class="linenos">329</span></a>            <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="map_united_states-330"><a href="#map_united_states-330"><span class="linenos">330</span></a>            <span class="s1">&#39;fillOpacity&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="map_united_states-331"><a href="#map_united_states-331"><span class="linenos">331</span></a>        <span class="p">},</span>
</span><span id="map_united_states-332"><a href="#map_united_states-332"><span class="linenos">332</span></a>        <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
</span><span id="map_united_states-333"><a href="#map_united_states-333"><span class="linenos">333</span></a>            <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GeoName&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;indicator_global_health_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="map_united_states-334"><a href="#map_united_states-334"><span class="linenos">334</span></a>            <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;État:&quot;</span><span class="p">,</span> <span class="s2">&quot;Indice santé :&quot;</span><span class="p">],</span>
</span><span id="map_united_states-335"><a href="#map_united_states-335"><span class="linenos">335</span></a>            <span class="n">localize</span><span class="o">=</span><span class="kc">True</span>
</span><span id="map_united_states-336"><a href="#map_united_states-336"><span class="linenos">336</span></a>        <span class="p">)</span>
</span><span id="map_united_states-337"><a href="#map_united_states-337"><span class="linenos">337</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="map_united_states-338"><a href="#map_united_states-338"><span class="linenos">338</span></a>
</span><span id="map_united_states-339"><a href="#map_united_states-339"><span class="linenos">339</span></a>    <span class="c1"># Ajouter la légende du colormap</span>
</span><span id="map_united_states-340"><a href="#map_united_states-340"><span class="linenos">340</span></a>    <span class="n">colormap</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="map_united_states-341"><a href="#map_united_states-341"><span class="linenos">341</span></a>
</span><span id="map_united_states-342"><a href="#map_united_states-342"><span class="linenos">342</span></a>    <span class="k">return</span> <span class="n">m</span>
</span></pre></div>


            <div class="docstring"><p>Crée une carte choroplèthe interactive des États-Unis représentant
un indicateur global de santé des enfants pour une année donnée.</p>

<p>La carte est générée à l’aide de Folium à partir de données géographiques
(GeoDataFrame) et d’un DataFrame contenant les indicateurs de santé.
Chaque État est coloré selon la valeur de l’indicateur, allant du rouge
(faible niveau de santé) au vert foncé (meilleur niveau de santé).</p>

<p>Args:
    df_indicator : pandas.DataFrame
        DataFrame contenant l'indicateur de santé par État.
        L'index doit correspondre au code FIPS des États (FIPSST).
        Il doit contenir une colonne nommée :
        "indicator_global_health_<year>".</p>

<pre><code>df_geo : geopandas.GeoDataFrame
    GeoDataFrame contenant les polygones des États américains.
    Doit inclure les colonnes :
    - "GeoFIPS" : code FIPS sous forme de chaîne
    - "GeoName" : nom de l'État
    - "geometry" : géométrie des États

year : str
    Année de l'indicateur de santé à afficher sur la carte.
</code></pre>

<p>Returns:
    folium.Map
        Objet Folium représentant la carte interactive des États-Unis,
        avec une légende et des infobulles affichant le nom de l'État
        et la valeur de l'indicateur de santé.</p>

<h2 id="references">Références</h2>

<p>Tutoriel Folium utilisé :
<a href="https://python-visualization.github.io/folium/latest/user_guide/geojson/geojson_popup_and_tooltip.html">https://python-visualization.github.io/folium/latest/user_guide/geojson/geojson_popup_and_tooltip.html</a></p>
</div>


                </section>
                <section id="interactive_map">
                            <input id="interactive_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">interactive_map</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df_indicator</span>, </span><span class="param"><span class="n">df_geo</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="interactive_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#interactive_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="interactive_map-345"><a href="#interactive_map-345"><span class="linenos">345</span></a><span class="k">def</span><span class="w"> </span><span class="nf">interactive_map</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">):</span>
</span><span id="interactive_map-346"><a href="#interactive_map-346"><span class="linenos">346</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="interactive_map-347"><a href="#interactive_map-347"><span class="linenos">347</span></a><span class="sd">    Affiche une carte interactive des États-Unis permettant de visualiser</span>
</span><span id="interactive_map-348"><a href="#interactive_map-348"><span class="linenos">348</span></a><span class="sd">    l&#39;évolution d&#39;un indicateur global de santé des enfants selon l&#39;année.</span>
</span><span id="interactive_map-349"><a href="#interactive_map-349"><span class="linenos">349</span></a>
</span><span id="interactive_map-350"><a href="#interactive_map-350"><span class="linenos">350</span></a><span class="sd">    Cette fonction utilise des widgets ipywidgets pour créer un menu</span>
</span><span id="interactive_map-351"><a href="#interactive_map-351"><span class="linenos">351</span></a><span class="sd">    déroulant de sélection de &#39;’année. Lorsque l&#39;année change, la carte</span>
</span><span id="interactive_map-352"><a href="#interactive_map-352"><span class="linenos">352</span></a><span class="sd">    choroplèthe correspondante est automatiquement mise à jour.</span>
</span><span id="interactive_map-353"><a href="#interactive_map-353"><span class="linenos">353</span></a>
</span><span id="interactive_map-354"><a href="#interactive_map-354"><span class="linenos">354</span></a><span class="sd">    Args:</span>
</span><span id="interactive_map-355"><a href="#interactive_map-355"><span class="linenos">355</span></a><span class="sd">        df_indicator : pandas.DataFrame</span>
</span><span id="interactive_map-356"><a href="#interactive_map-356"><span class="linenos">356</span></a><span class="sd">            DataFrame contenant les indicateurs de santé par État et par année.</span>
</span><span id="interactive_map-357"><a href="#interactive_map-357"><span class="linenos">357</span></a><span class="sd">            L&#39;index doit correspondre au code FIPS des États (FIPSST).</span>
</span><span id="interactive_map-358"><a href="#interactive_map-358"><span class="linenos">358</span></a><span class="sd">            Les colonnes doivent être nommées sous la forme :</span>
</span><span id="interactive_map-359"><a href="#interactive_map-359"><span class="linenos">359</span></a><span class="sd">            &quot;indicator_global_health_&lt;year&gt;&quot;.</span>
</span><span id="interactive_map-360"><a href="#interactive_map-360"><span class="linenos">360</span></a>
</span><span id="interactive_map-361"><a href="#interactive_map-361"><span class="linenos">361</span></a><span class="sd">        df_geo : geopandas.GeoDataFrame</span>
</span><span id="interactive_map-362"><a href="#interactive_map-362"><span class="linenos">362</span></a><span class="sd">            GeoDataFrame contenant les informations géographiques des États</span>
</span><span id="interactive_map-363"><a href="#interactive_map-363"><span class="linenos">363</span></a><span class="sd">            américains (polygones, noms des États et codes FIPS).</span>
</span><span id="interactive_map-364"><a href="#interactive_map-364"><span class="linenos">364</span></a>
</span><span id="interactive_map-365"><a href="#interactive_map-365"><span class="linenos">365</span></a><span class="sd">    Returns:</span>
</span><span id="interactive_map-366"><a href="#interactive_map-366"><span class="linenos">366</span></a><span class="sd">        None</span>
</span><span id="interactive_map-367"><a href="#interactive_map-367"><span class="linenos">367</span></a><span class="sd">            La fonction ne retourne rien. Elle affiche directement un widget</span>
</span><span id="interactive_map-368"><a href="#interactive_map-368"><span class="linenos">368</span></a><span class="sd">            interactif et une carte Folium dans le notebook Jupyter.</span>
</span><span id="interactive_map-369"><a href="#interactive_map-369"><span class="linenos">369</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="interactive_map-370"><a href="#interactive_map-370"><span class="linenos">370</span></a>
</span><span id="interactive_map-371"><a href="#interactive_map-371"><span class="linenos">371</span></a>    <span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2021&quot;</span><span class="p">,</span> <span class="s2">&quot;2022&quot;</span><span class="p">,</span> <span class="s2">&quot;2023&quot;</span><span class="p">,</span> <span class="s2">&quot;2024&quot;</span><span class="p">]</span>
</span><span id="interactive_map-372"><a href="#interactive_map-372"><span class="linenos">372</span></a>    <span class="n">year_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
</span><span id="interactive_map-373"><a href="#interactive_map-373"><span class="linenos">373</span></a>        <span class="n">options</span><span class="o">=</span><span class="n">years</span><span class="p">,</span>
</span><span id="interactive_map-374"><a href="#interactive_map-374"><span class="linenos">374</span></a>        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;2024&quot;</span><span class="p">,</span>
</span><span id="interactive_map-375"><a href="#interactive_map-375"><span class="linenos">375</span></a>        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Année:&#39;</span><span class="p">,</span>
</span><span id="interactive_map-376"><a href="#interactive_map-376"><span class="linenos">376</span></a>    <span class="p">)</span>
</span><span id="interactive_map-377"><a href="#interactive_map-377"><span class="linenos">377</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
</span><span id="interactive_map-378"><a href="#interactive_map-378"><span class="linenos">378</span></a>
</span><span id="interactive_map-379"><a href="#interactive_map-379"><span class="linenos">379</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_map</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
</span><span id="interactive_map-380"><a href="#interactive_map-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="interactive_map-381"><a href="#interactive_map-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="interactive_map-382"><a href="#interactive_map-382"><span class="linenos">382</span></a>        <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
</span><span id="interactive_map-383"><a href="#interactive_map-383"><span class="linenos">383</span></a>            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="interactive_map-384"><a href="#interactive_map-384"><span class="linenos">384</span></a>            <span class="n">display</span><span class="p">(</span><span class="n">map_united_states</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]))</span>
</span><span id="interactive_map-385"><a href="#interactive_map-385"><span class="linenos">385</span></a>
</span><span id="interactive_map-386"><a href="#interactive_map-386"><span class="linenos">386</span></a>    <span class="n">year_selector</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_map</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span><span id="interactive_map-387"><a href="#interactive_map-387"><span class="linenos">387</span></a>    <span class="n">display</span><span class="p">(</span><span class="n">year_selector</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</span><span id="interactive_map-388"><a href="#interactive_map-388"><span class="linenos">388</span></a>    <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
</span><span id="interactive_map-389"><a href="#interactive_map-389"><span class="linenos">389</span></a>        <span class="n">display</span><span class="p">(</span><span class="n">map_united_states</span><span class="p">(</span><span class="n">df_indicator</span><span class="p">,</span> <span class="n">df_geo</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year_selector</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Affiche une carte interactive des États-Unis permettant de visualiser
l'évolution d'un indicateur global de santé des enfants selon l'année.</p>

<p>Cette fonction utilise des widgets ipywidgets pour créer un menu
déroulant de sélection de '’année. Lorsque l'année change, la carte
choroplèthe correspondante est automatiquement mise à jour.</p>

<p>Args:
    df_indicator : pandas.DataFrame
        DataFrame contenant les indicateurs de santé par État et par année.
        L'index doit correspondre au code FIPS des États (FIPSST).
        Les colonnes doivent être nommées sous la forme :
        "indicator_global_health_<year>".</p>

<pre><code>df_geo : geopandas.GeoDataFrame
    GeoDataFrame contenant les informations géographiques des États
    américains (polygones, noms des États et codes FIPS).
</code></pre>

<p>Returns:
    None
        La fonction ne retourne rien. Elle affiche directement un widget
        interactif et une carte Folium dans le notebook Jupyter.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>